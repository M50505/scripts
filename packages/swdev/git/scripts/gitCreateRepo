#!/usr/bin/env bash
# vim:tabstop=2:shiftwidth=2:nu:filetype=sh
#	
# Author:              Martin Cribbins
# Revision history:
#
# 2021-07-10 - Initial version.
#	
_doc ${1} 20210710125553 "creates a new respository on the specified cloud Git provider, if it does not already exist. The Git provider is specified either as the first argument, otherwise it is obtained from the value of the GITPROVIDER environment variable." && exit 0

if [[ $# -eq 0 ]]
then
	repoDir=.
else
	repoDir="${1}"
fi

provider=$(gitGetProvider)
token=$(gitGetToken)

user=$(gitGetUser)

if [[ -z ${user} ]]
then
	msgError <<EOF
There is no git user currently set. Please use gitInit <user> to establish the
desired user and its credentials.
EOF

	exit 1
fi

if [[ ! -d "${repoDir}" ]]
then
	mkdir "${repoDir}"
fi

cd "${repoDir}"

repo=$(basename ${PWD})

result=$(curl -s -u ${user}:${token} --data "{\"name\":\"${repo}\",\"private\":\"true\",\"auto_init\":\"true\"}" https://api.github.com/user/repos)

successID=$(echo ${result} | jq ".id")

if [[ ${successID} = null ]]
then
	msgError <<EOF
Failed to create remote repository ${repo} for user ${user} on ${provider}:
$(echo ${result} | jq ".message,.errors[0].message" | tr -d \" | tr \\n ' ')
EOF
	exit 1
fi

msgInfo "Remote repository ${repo} created for user ${user} on ${provider}, cloning new empty repository."

exit

git init

git remote add origin https://github.com/${user}/${repo}.git

#git config --global --add push.default current
#git config --global --add push.autoSetupRemote true
#git config --global init.defaultBranch main


cat <<EOF > README.md
= ${repo}

== Introduction

EOF

mv README.md README.adoc


gitWip "Converted the README.md to an AsciiDoc file name README.adoc"

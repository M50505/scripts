#!/usr/bin/env bash
# vim:tabstop=2:shiftwidth=2:nu:filetype=sh
#	
# Author:              Martin Cribbins
# Revision history:
#
# 2021-07-10 - Initial version.
#	
_doc ${1} 20210710125553 "creates a new respository on the specified cloud Git provider, if it does not already exist. The Git provider is specified either as the first argument, otherwise it is obtained from the value of the GITPROVIDER environment variable." && exit 0

#[[ -n ${input} ]] && exec 0<${input}
#[[ -n ${output} ]] && exec 1>${output}

#. ${HOME}/.gitsetup

repo=${1}
provider=$(gitGetProvider)


case ${provider} in
	github.com)
		result=$(curl -s -u ${GIT_USER}:${GIT_API_KEY} --data "{\"name\":\"${repo}\",\"private\":\"true\"}" https://api.github.com/user/repos)

		successID=$(echo ${result} | jq ".id")

		if [[ ${successID} = null ]]
		then
			cat>&2 <<EOF
Failed to create remote repository ${repo} for user ${GIT_USE} on ${gitProvider}:
$(echo ${result} | jq ".message,.errors[0].message" | tr -d \" | tr \\n ' ')
EOF
		else
			echo "Remote repository ${repo} created for user ${GIT_USER} on ${gitProvider}, cloning new empty repository."
			git clone git@github.com:${GIT_USER}/${repo}.git
		fi
		;;
esac

